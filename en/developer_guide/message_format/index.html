
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://onukiyuma.github.io/SINETStream/en/developer_guide/message_format/">
      
      
        <link rel="prev" href="../plugin_compression_java/">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>メッセージフォーマット - SINETStream</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../styles/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../" title="SINETStream" class="md-header__button md-logo" aria-label="SINETStream" data-md-component="logo">
      
  <img src="../../../images/SiNETStream.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SINETStream
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              メッセージフォーマット
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../../developer_guide/message_format/" hreflang="ja" class="md-select__link">
              日本語
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../docm/" class="md-tabs__link">
          
  
  SINETStreamについて

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorial/" class="md-tabs__link">
          
  
  Tutorial

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../userguide/" class="md-tabs__link">
          
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Developer guide

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../" title="SINETStream" class="md-nav__button md-logo" aria-label="SINETStream" data-md-component="logo">
      
  <img src="../../../images/SiNETStream.png" alt="logo">

    </a>
    SINETStream
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SINETStreamについて
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            SINETStreamについて
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../performance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance measurement of SINETStream
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livedemo/livedemo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Live demo of SINETStream
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Build SINETStream server
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Build SINETStream server
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../server/brokers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server construction procedure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../server/brokers/%E3%83%97%E3%83%A9%E3%82%A4%E3%83%99%E3%83%BC%E3%83%88%E8%AA%8D%E8%A8%BC%E5%B1%80%E3%81%A7%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%82%92%E4%BD%9C%E6%88%90/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating a certificate with a private certificate authority
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../server/brokers/Kafkabroker%E3%81%AE%E6%A7%8B%E7%AF%89%E6%89%8B%E9%A0%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mosquitto construction procedure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../server/brokers/mosquitto%E6%A7%8B%E7%AF%89%E6%89%8B%E9%A0%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka broker setup procedure
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CHANGELOG/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update log
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python/Java
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Python/Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/TUTORIAL-STEP1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STEP1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/TUTORIAL-STEP2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STEP2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Android
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Android
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    sinetstream-android-echo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            sinetstream-android-echo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step1-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    テキスト送受信アプリの実行
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ANDROID-STEP1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_2_3" id="__nav_3_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    sinetstream-android-sensor-publisher
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_3">
            <span class="md-nav__icon md-icon"></span>
            sinetstream-android-sensor-publisher
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step2-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    センサ情報収集アプリの実行
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ANDROID-STEP2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step2-webbrowser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    センサーデータ可視化用のウェブインタフェース
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step2-location/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    端末位置情報の自動更新
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/sinetstreamhelper-tutorial-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SINETStream Android Tutorial Container
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Androidサンプルアプリケーションの導入
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-keychain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    システム秘匿領域への証明書ファイルの導入
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/sinetstreamhelper-tutorial-container/TUTORIAL-docker-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DOCKER-CONTAINER
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/api-python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/api-java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Android
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Android
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SINETStream for Android ユーザガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/api-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android版SINETStreamライブラリ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http://javadoc.android.sinetstream.net/sinetstream-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API (Javadoc)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/config-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android版のSINETStream設定ファイル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/config-client-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android版の設定クライアント
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SINETStreamHelper
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            SINETStreamHelper
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/libhelper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SINETStreamHelper ユーザガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/api-libhelper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SINETStreamHelperライブラリ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http://javadoc.android.sinetstream.net/sinetstream-android-helper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API (Javadoc)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    設定ファイル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認証と認可
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/nii-gakunin-cloud/sinetstream/blob/main/java/sample/cli/README.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI(Command Line Interface)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/compat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    互換性
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Developer guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Developer guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    開発者ガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Messaging system
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Messaging system
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_broker_python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_broker_java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    message type
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            message type
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_value_type_python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_value_type_java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    compression
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            compression
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_compression_python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_compression_java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    メッセージフォーマット
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    メッセージフォーマット
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      互換性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-0" class="md-nav__link">
    <span class="md-ellipsis">
      Version 0
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Version 0">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      フォーマット
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-1" class="md-nav__link">
    <span class="md-ellipsis">
      Version 1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Version 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sinetstream_configyml" class="md-nav__link">
    <span class="md-ellipsis">
      sinetstream_config.ymlで指定するパスワードと暗号パラメータ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      フォーマット
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フォーマット">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#v1" class="md-nav__link">
    <span class="md-ellipsis">
      送信時(暗号化)のながれ(V1)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v1_1" class="md-nav__link">
    <span class="md-ellipsis">
      受信時(復号)のながれ(V1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      暗号鍵
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ivinitialization-vector" class="md-nav__link">
    <span class="md-ellipsis">
      IV(Initialization Vector)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auth-tag" class="md-nav__link">
    <span class="md-ellipsis">
      auth tag(認証タグ)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-2" class="md-nav__link">
    <span class="md-ellipsis">
      Version 2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Version 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      フォーマット
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-2avro" class="md-nav__link">
    <span class="md-ellipsis">
      Version 2がつかうAvroのスキーマ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2" class="md-nav__link">
    <span class="md-ellipsis">
      送信時のながれ(V2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2_1" class="md-nav__link">
    <span class="md-ellipsis">
      受信時のながれ(V2)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-21" class="md-nav__link">
    <span class="md-ellipsis">
      Version 2.1
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-3" class="md-nav__link">
    <span class="md-ellipsis">
      Version 3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Version 3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      フォーマット
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v3" class="md-nav__link">
    <span class="md-ellipsis">
      送信時のながれ(V3)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v3_1" class="md-nav__link">
    <span class="md-ellipsis">
      受信時のながれ(V3)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      互換性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-0" class="md-nav__link">
    <span class="md-ellipsis">
      Version 0
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Version 0">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      フォーマット
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-1" class="md-nav__link">
    <span class="md-ellipsis">
      Version 1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Version 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sinetstream_configyml" class="md-nav__link">
    <span class="md-ellipsis">
      sinetstream_config.ymlで指定するパスワードと暗号パラメータ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      フォーマット
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フォーマット">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#v1" class="md-nav__link">
    <span class="md-ellipsis">
      送信時(暗号化)のながれ(V1)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v1_1" class="md-nav__link">
    <span class="md-ellipsis">
      受信時(復号)のながれ(V1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      暗号鍵
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ivinitialization-vector" class="md-nav__link">
    <span class="md-ellipsis">
      IV(Initialization Vector)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auth-tag" class="md-nav__link">
    <span class="md-ellipsis">
      auth tag(認証タグ)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-2" class="md-nav__link">
    <span class="md-ellipsis">
      Version 2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Version 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      フォーマット
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-2avro" class="md-nav__link">
    <span class="md-ellipsis">
      Version 2がつかうAvroのスキーマ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2" class="md-nav__link">
    <span class="md-ellipsis">
      送信時のながれ(V2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2_1" class="md-nav__link">
    <span class="md-ellipsis">
      受信時のながれ(V2)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-21" class="md-nav__link">
    <span class="md-ellipsis">
      Version 2.1
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-3" class="md-nav__link">
    <span class="md-ellipsis">
      Version 3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Version 3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      フォーマット
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v3" class="md-nav__link">
    <span class="md-ellipsis">
      送信時のながれ(V3)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v3_1" class="md-nav__link">
    <span class="md-ellipsis">
      受信時のながれ(V3)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<!--
Copyright (C) 2021 National Institute of Informatics

Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<p><a href="https://translate.google.com/translate?hl=en&amp;sl=ja&amp;tl=en&amp;u=https://nii-gakunin-cloud.github.io/sinetstream/docs/developer_guide/message_format.html" title="google translate">English</a></p>
<h1 id="_1">メッセージフォーマット</h1>
<h2 id="_2">互換性</h2>
<pre><code> ________     ________     ________
|        |   |        |   |        |
| Writer |   | Broker |   | Reader |
|________|   |________|   |________|
     |__________|  |__________|
</code></pre>
<ul>
<li>互換性が保てないメッセージフォーマットの変更が行われるとフォーマットバージョンのメジャー番号が上がる。</li>
<li>後方互換性を保った変更の場合はマイナー番号が上がる。</li>
</ul>
<h2 id="version-0">Version 0</h2>
<p>ユーザからわたされたメッセージを(value_typeに応じてシリアライズしたあと)
そのままメッセージングシステムにわたす。
つまりSINETStreamレイヤではなにもしない。</p>
<h3 id="_3">フォーマット</h3>
<p>先頭から:</p>
<ul>
<li>plaintext<ul>
<li>ユーザメッセージのバイト列</li>
</ul>
</li>
</ul>
<h2 id="version-1">Version 1</h2>
<p>ユーザからわたされたメッセージを共通鍵暗号で暗号化してメッセージングシステムにわたす。
暗号をつかう設定をしなければversion 0とおなじで素通しになる。</p>
<p>パスワードと暗号パラメータはreaderとwriterで同じ設定を使わなければならない。</p>
<h4 id="sinetstream_configyml">sinetstream_config.ymlで指定するパスワードと暗号パラメータ</h4>
<pre><code>&lt;service&gt;:
    crypto:
        data_encryption: true
        password:
            value: &lt;password&gt;
        algorithm: &lt;algorithm&gt;
        key_length: &lt;key_length&gt;
        mode: &lt;mode&gt;
        padding: &lt;padding&gt;
        key_derivation:
            algorithm: &lt;kd_algorithm&gt;
            salt_bytes: &lt;kd_salt_bytes&gt;
            iteration: &lt;kd_iteration&gt;
            prf: &lt;kd_prf&gt;

</code></pre>
<h3 id="_4">フォーマット</h3>
<p>先頭から:</p>
<ul>
<li>salt<ul>
<li>鍵導出につかった乱数</li>
<li>バイト長: kd_salt_bytes</li>
</ul>
</li>
<li>IV<ul>
<li>暗号モードの初期ベクトル</li>
<li>バイト長: 16</li>
</ul>
</li>
<li>chipertext<ul>
<li>暗号化されたユーザメッセージのバイト列</li>
</ul>
</li>
<li>auth tag<ul>
<li>暗号メッセージの検証コード</li>
<li>バイト長: 暗号モードによる<ul>
<li>AES/EAXのとき8</li>
<li>AES/GCMのとき16</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>暗号化しない場合はV0とおなじである。</p>
<h4 id="v1">送信時(暗号化)のながれ(V1)</h4>
<pre><code>                    ユーザからわたされたメッセージ
                       |
                       | serialize(value_type)
                       V
                    cleartext (バイト列)
                      /|                                  +-- key derivation with
                     / | encrypt with                     |      パスワード(password)
                    /  |    暗号アルゴリズム(algorithm)   |      ソルト(初期化時に乱数生成)
                   /   |    暗号利用モード(mode)          |      鍵長(key_length)
                  /    |    バディング(padding)           |      鍵導出アルゴリズム(kd_algorithm)
   ______________/     |    鍵長(key_length)              |      反復回数(kd_iteration)
  |非暗号化時          |    暗号鍵 &lt;----------------------+      疑似乱数関数(kd_prf)
  |                    |    IV(送信するごとに乱数生成)
  |                    |
  |                    V
  |                 ciphertext (+ auth tag)
  |                    |
  |                    V
  |     salt + IV + ciphertext (+ auth tag)
  |    \___________________________________/
  |        |
  V        V
メッセージングシステムへ
</code></pre>
<h3 id="v1_1">受信時(復号)のながれ(V1)</h3>
<pre><code>                    メッセージ ユーザへ
                       A
                       | deserialize(value_type)
                       |
                    cleartext (バイト列)
                       A
                      /|                                  +-- key derivation with
                     / | decrypt with                     |      パスワード(password)
                    /  |    暗号アルゴリズム(algorithm)   |      ソルト(受信メッセージから)
                   /   |    暗号利用モード(mode)          |      鍵長(key_length)
                  /    |    バディング(padding)           |      鍵導出アルゴリズム(kd_algorithm)
   ______________/     |    鍵長(key_length)              |      反復回数(kd_iteration)
  |非暗号時            |    暗号鍵 &lt;----------------------+      疑似乱数関数(kd_prf)
  |                    |    IV(受信メッセージから)
  |                    |
  |                    |
  |     salt + IV + ciphertext (+ auth tag)
  |    \___________________________________/
  |        A
  |        | 分解
  |        |
メッセージングシステムから
</code></pre>
<p>auth tagはGCM,EAXなど認証付暗号の場合のみ追加される。</p>
<h3 id="_5">暗号鍵</h3>
<p>設定ファイルで指定されたパスワードから鍵導出アルゴリズムにより暗号鍵が生成される。
鍵導出アルゴリムズをつかうことの利点:</p>
<ul>
<li>任意の鍵長に対応できる。</li>
<li>ソルトをつけることで辞書攻撃を困難にする。<ul>
<li>ソルトはWriterオブジェクトを初期化するときに生成することを想定している。</li>
<li>Reader側はメッセージにくっついているソルトを用いて暗号鍵を作成する。
  同じWriterからのメッセージは同じソルトがつかわれていると想定できるので、
  ソルト→暗号鍵のキャッシュを使用する。</li>
</ul>
</li>
</ul>
<h3 id="ivinitialization-vector">IV(Initialization Vector)</h3>
<p>暗号利用モードによって要求される初期値で、
平文が同じでも異なる暗号文を生成して推測されにくくするためのものである。
メッセージを送信するごとに乱数生成する。</p>
<p>CTRモードではnonceになる。</p>
<p>暗号アルゴリズムがAESのとき暗号利用モードによらずkey_lengthによらず、
IVのサイズは128ビット(16バイト)である。</p>
<h3 id="auth-tag">auth tag(認証タグ)</h3>
<p>認証付暗号をつかったときの認証タグで、
暗号アルゴリズムがAESのとき128ビット(16バイト)である。</p>
<h2 id="version-2">Version 2</h2>
<p>暗号化機能に加え、メッセージに送信時刻のタイムスタンプをつける。
タイムスタンプをつけない設定はできない。</p>
<p>タイムスタンプをつけるのに<a href="http://avro.apache.org/">Apache Avro</a>の<a href="http://avro.apache.org/docs/current/spec.html#single_object_encoding">Sigle-object Encoding</a>をつかう。
Avro Sigle-object EncodingはAvro Binary Encodingの前にAvro markerとスキーマのフィンガープリントをつけくわえたものである。</p>
<h3 id="_6">フォーマット</h3>
<p>先頭から:</p>
<ul>
<li>salt<ul>
<li>鍵導出につかった乱数</li>
<li>バイト長: kd_salt_bytes</li>
</ul>
</li>
<li>IV<ul>
<li>暗号モードの初期ベクトル</li>
<li>バイト長: 16</li>
</ul>
</li>
<li>暗号化されたAvro Single-objectメッセージ<ul>
<li>Avroメッセージマーカー<ul>
<li>バイト長: 2</li>
<li><code>C3 01</code></li>
<li>1バイト目の <code>C3</code> はLatin1でÃになりAvroっぽい文字ということで選ばれたようだ。</li>
<li>2バイト目の <code>01</code> はバージョン番号を意味するようだ。</li>
</ul>
</li>
<li>Avroスキーマフィンガープリント<ul>
<li>バイト長: 8</li>
<li>使うスキーマのCRC-64-AVROを計算したもの。</li>
<li>V2での値は <code>1F 9C 0C 91 EB 33 06 4F</code> になる。</li>
</ul>
</li>
<li>timestamp<ul>
<li>SINETStream APIが呼ばれた時刻のUNIX時間(単位はマイクロ秒)。</li>
<li>Avroではlong型になる。</li>
</ul>
</li>
<li>msg<ul>
<li>ユーザメッセージのバイト列</li>
</ul>
</li>
</ul>
</li>
<li>auth tag<ul>
<li>暗号メッセージの検証コード</li>
<li>バイト長: 暗号モードによる<ul>
<li>AES/EAXのとき8</li>
<li>AES/GCMのとき16</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>暗号化無効時は:</p>
<ul>
<li>Avro Single-objectメッセージ<ul>
<li>Avroメッセージマーカー</li>
<li>Avroスキーマフィンガープリント</li>
<li>timestamp</li>
<li>msg</li>
</ul>
</li>
</ul>
<h3 id="version-2avro">Version 2がつかうAvroのスキーマ</h3>
<pre><code>{
  &quot;namespace&quot;: &quot;jp.ad.sinet.stream&quot;,
  &quot;type&quot;: &quot;record&quot;,
  &quot;name&quot;: &quot;message&quot;,
  &quot;fields&quot;: [
    {
      &quot;name&quot;: &quot;tstamp&quot;,
      &quot;type&quot;: {
        &quot;type&quot;: &quot;long&quot;,
        &quot;logicalType&quot;: &quot;timestamp-micros&quot;
      }
    },
    {
      &quot;name&quot;: &quot;msg&quot;,
      &quot;type&quot;: &quot;bytes&quot;
    }
  ]
}
</code></pre>
<h3 id="v2">送信時のながれ(V2)</h3>
<pre><code>                     ユーザからわたされたメッセージ
                        |
                        | serialize(value_type)
                        V
                     byte-stream     tstamp (unix時刻 in ms)
                        |               |
                        V_______________V
                        |
                        | Avro encode
                        V
                     Avro Single-object encodedメッセージ
                       /|
                      / | encrypt &lt;--- 暗号鍵 &lt;-------------------- パスワード
   __________________/  |       A                 key derivation
  |非暗号時             |       |                           A
  |                     |      IV(乱数)                     |
  |                     V                                  salt(乱数)
  |      salt + IV + ciphertext (+ auth tag)
  |     \___________________________________/
  |                 |
  V                 V
メッセージングシステムへ
</code></pre>
<h3 id="v2_1">受信時のながれ(V2)</h3>
<pre><code>                    メッセージ ユーザへ              tstamp (unix時刻 in ms) ユーザへ
                       A                               A
                       | deserialize(value_type)       |
                       |                               |
                    byte-stream                        |
                       A                               |
                       |_______________________________|
                       |
                       | Avro decode
                       |
                    Avro Single-object encodedメッセージ
                       A
                      /| decrypt &lt;--- 暗号鍵 &lt;-------------------- パスワード
                     / |       A                 key derivation
   _________________/  |       |                           A
  |非暗号時            |     IV(受信メッセージから)        |
  |                    |                                  salt(受信メッセージから)
  |     salt + IV + ciphertext (+ auth tag)
  |    \___________________________________/
  |                A
  |                | 分解
  |                |
メッセージングシステムから
</code></pre>
<h2 id="version-21">Version 2.1</h2>
<p>timestmap=0はタイムスタンプが設定されていないことを示す。</p>
<h2 id="version-3">Version 3</h2>
<p>メッセージの暗号化につかうパスワードを途中で変更できるように、
鍵バージョンをメッセージにつけくわえる。</p>
<h3 id="_7">フォーマット</h3>
<p>先頭から:</p>
<ul>
<li>message marker<ul>
<li>バイト長: 4</li>
<li><code>DF 03 00 00</code></li>
<li>1バイト目の <code>DF</code> はLatin1でßになりSINETStreamっぽい文字ということで選ばれた。</li>
<li>2バイト目の <code>03</code> はバージョン番号を意味する。</li>
<li>3～4バイト目の <code>00</code> はV2フォーマットとの衝突確率を低減するためのフィラー。</li>
</ul>
</li>
<li>key version<ul>
<li>バイト長: 2</li>
<li>鍵バージョン番号(符号無し整数)<ul>
<li>0 は暗号化なしを意味する。</li>
</ul>
</li>
<li>バイトオーダーはビッグエンディアン。</li>
<li>鍵バージョン番号は頻繁に更新されないと想定して2バイトとした。</li>
</ul>
</li>
<li>salt<ul>
<li>鍵導出につかった乱数</li>
<li>バイト長: kd_salt_bytes<ul>
<li>パスワードから鍵導出したのではなく鍵を直接指定した場合は長さ0である。</li>
</ul>
</li>
</ul>
</li>
<li>IV<ul>
<li>暗号モードの初期ベクトル</li>
<li>バイト長: 16</li>
</ul>
</li>
<li>暗号化されたAvro Single-objectメッセージ<ul>
<li>Avroメッセージマーカー<ul>
<li>バイト長: 2</li>
<li><code>C3 01</code></li>
<li>1バイト目の <code>C3</code> はLatin1でÃになりAvroっぽい文字ということで選ばれたようだ。</li>
<li>2バイト目の <code>01</code> はバージョン番号を意味するようだ。</li>
</ul>
</li>
<li>Avroスキーマフィンガープリント<ul>
<li>バイト長: 8</li>
<li>使うスキーマのCRC-64-AVROを計算したもの。</li>
<li>V2での値は <code>1F 9C 0C 91 EB 33 06 4F</code> になる。</li>
</ul>
</li>
<li>timestamp<ul>
<li>SINETStream APIが呼ばれた時刻のUNIX時間(単位はマイクロ秒)。</li>
<li>Avroではlong型になる。</li>
</ul>
</li>
<li>msg<ul>
<li>ユーザメッセージのバイト列</li>
</ul>
</li>
</ul>
</li>
<li>auth tag<ul>
<li>暗号メッセージの検証コード</li>
<li>バイト長: 暗号モードによる<ul>
<li>AES/EAXのとき8</li>
<li>AES/GCMのとき16</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>暗号化無効時は:</p>
<ul>
<li>message marker<ul>
<li><code>DF 03 00 00</code></li>
</ul>
</li>
<li>key version<ul>
<li><code>00 00</code></li>
<li>暗号化なしのときは鍵バージョンは 0 を指定しなければならない。</li>
</ul>
</li>
<li>Avro Single-objectメッセージ<ul>
<li>Avroメッセージマーカー</li>
<li>Avroスキーマフィンガープリント</li>
<li>timestamp</li>
<li>msg</li>
</ul>
</li>
</ul>
<blockquote>
<p>鍵バージョンを付加するのにAvro Single-object encodingをつかいたいところだが、
Avroメッセージの入れ子構造を扱えないプロダクトに考慮して
単純なバイナリフォーマットにした。</p>
</blockquote>
<h3 id="v3">送信時のながれ(V3)</h3>
<pre><code>                               ユーザからわたされたメッセージ
                                  |
                                  | serialize(value_type)
                                  V
                               byte-stream     tstamp (unix時刻 in ms)
                                  |               |
                                  V_______________V
                                  |
                                  | Avro encode
                                  V
                               Avro Single-object encodedメッセージ
                                 /|                       +------------------- key &lt;-------+--- ConfigServer.getKey()
                                / |                       |                                |                   or
                               /  | encrypt &lt;--- 暗号鍵 &lt;-+------------------- password &lt;-+)--- ConfigServer.getPasswd()
              ________________/   |       A                  key derivation               ||
             |非暗号時            |       |                            A                  VV
             |                    |      IV(乱数)                      |                key version
             |                    V                                   salt(乱数)
             |     salt + IV + ciphertext (+ auth tag)
             |    \___________________________________/
             |                    |
             |____________________|
                                  |
                 message          V
         marker + key_version + {   }
        \____________________________/
           |
           V
        メッセージングシステムへ
</code></pre>
<h3 id="v3_1">受信時のながれ(V3)</h3>
<pre><code>                               メッセージ ユーザへ              tstamp (unix時刻 in ms) ユーザへ
                                  A                               A
                                  | deserialize(value_type)       |
                                  |                               |
                               byte-stream                        |
                                  A                               |
                                  |_______________________________|
                                  |
                                  | Avro decode
                                  |
                               Avro Single-object encodedメッセージ
                                  A
                                  |                           ConfigServer.getKey(key_version)
                                  |                            |            when cache-miss
                                  |                           _V_____
                                  |                       +--|key|ver|&lt;--- key version
                                  |                       |  |   |   |    (受信メッセージから)
                                  |                       |  |___|___|
                                  |                       |   cache
                                  |                       |                   ConfigServer.getPasswd(key_version)
                                  |                       |                      |            when cache-miss
                                 /|                       |                   ___V________
                                / | decrypt &lt;--- 暗号鍵 &lt;-+------------------|password|ver|&lt;--- key version
              _________________/  |       A                 key derivation   |        |   |    (受信メッセージから)
             |非暗号時            |       |                           A      |________|___|
             |                    |     IV(受信メッセージから)        |       cache
             |                    V                                   |
             |     salt + IV + ciphertext (+ auth tag)               salt(受信メッセージから)
             |    \___________________________________/
             |                    A
             |                    | 分解
             |____________________|
                                  |
         message                  |
         marker + key_version + {   }
        \____________________________/
           A
           | 分解
           |
        メッセージングシステムから
</code></pre>
<!--- link definitions --->












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <div class="site-footer-copyright">Copyright(C) National Institute of Informatics</div>
<div class="site-footer-logo">
  <a href="https://www.nii.ac.jp/">
    
    <img src="../../../images/NIIlogo_EN_ls.png" alt="NII National Institute of Informatics">
    
  </a>
</div>
<footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.expand", "navigation.tabs", "navigation.tabs.sticky", "navigation.top"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>