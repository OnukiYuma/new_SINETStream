
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://onukiyuma.github.io/SINETStream/developer_guide/plugin_broker_python/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../plugin_broker_java/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Python - SINETStream</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../styles/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#messaging-system-python" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../.." title="SINETStream" class="md-header__button md-logo" aria-label="SINETStream" data-md-component="logo">
      
  <img src="../../images/SiNETStream.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SINETStream
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Python
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="言語切り替え">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="ja" class="md-select__link">
              日本語
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../en/developer_guide/plugin_broker_python/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="タブ" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../docm/" class="md-tabs__link">
          
  
  SINETStreamについて

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorial/" class="md-tabs__link">
          
  
  チュートリアル

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../userguide/" class="md-tabs__link">
          
  
  ユーザガイド

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  プラグイン開発ガイド

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SINETStream" class="md-nav__button md-logo" aria-label="SINETStream" data-md-component="logo">
      
  <img src="../../images/SiNETStream.png" alt="logo">

    </a>
    SINETStream
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SINETStreamについて
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            SINETStreamについて
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ドキュメント
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../performance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SINETStream性能測定結果
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livedemo/livedemo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SINETStreamのライブデモ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SINETStreamサーバ構築手順
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            SINETStreamサーバ構築手順
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../server/brokers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    サーバ構築手順
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../server/brokers/%E3%83%97%E3%83%A9%E3%82%A4%E3%83%99%E3%83%BC%E3%83%88%E8%AA%8D%E8%A8%BC%E5%B1%80%E3%81%A7%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%82%92%E4%BD%9C%E6%88%90/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    プライベート認証局で証明書を作成する
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../server/brokers/Kafkabroker%E3%81%AE%E6%A7%8B%E7%AF%89%E6%89%8B%E9%A0%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka brokerの構築手順
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../server/brokers/mosquitto%E6%A7%8B%E7%AF%89%E6%89%8B%E9%A0%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mosquitto(MQTT broker)の構築手順
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CHANGELOG/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    更新履歴
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    チュートリアル
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            チュートリアル
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python/Java版
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Python/Java版
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    クイックスタートガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/TUTORIAL-STEP1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STEP1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/TUTORIAL-STEP2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STEP2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Android版
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Android版
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    クイックスタートガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    sinetstream-android-echo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            sinetstream-android-echo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step1-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    テキスト送受信アプリの実行
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ANDROID-STEP1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_2_3" id="__nav_3_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    sinetstream-android-sensor-publisher
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_3">
            <span class="md-nav__icon md-icon"></span>
            sinetstream-android-sensor-publisher
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step2-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    センサ情報収集アプリの実行
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ANDROID-STEP2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step2-webbrowser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    センサーデータ可視化用のウェブインタフェース
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-step2-location/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    端末位置情報の自動更新
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/sinetstreamhelper-tutorial-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SINETStream Android Tutorial Container
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Androidサンプルアプリケーションの導入
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/TUTORIAL-android-keychain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    システム秘匿領域への証明書ファイルの導入
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial-android/sinetstreamhelper-tutorial-container/TUTORIAL-docker-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DOCKER-CONTAINER
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ユーザガイド
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            ユーザガイド
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ユーザガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/api-python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/api-java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Android版
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Android版
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SINETStream for Android ユーザガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/api-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android版SINETStreamライブラリ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http://javadoc.android.sinetstream.net/sinetstream-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API (Javadoc)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/config-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android版のSINETStream設定ファイル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/config-client-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android版の設定クライアント
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SINETStreamHelper
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            SINETStreamHelper
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/libhelper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SINETStreamHelper ユーザガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/api-libhelper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SINETStreamHelperライブラリ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http://javadoc.android.sinetstream.net/sinetstream-android-helper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API (Javadoc)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    設定ファイル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認証と認可
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/nii-gakunin-cloud/sinetstream/blob/main/java/sample/cli/README.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI(Command Line Interface)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/compat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    互換性
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    プラグイン開発ガイド
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            プラグイン開発ガイド
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    開発者ガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Messaging system
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Messaging system
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Python
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. はじめに
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. はじめに">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 対象者
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 前提知識
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-sinetstream" class="md-nav__link">
    <span class="md-ellipsis">
      2. SINETStream の内部構造について
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. SINETStream の内部構造について">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 モジュール構成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 処理シーケンス
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2 処理シーケンス">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-messagereader" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.1 MessageReader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-messagewriter" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2 MessageWriter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-asyncmessagereader" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.3 AsyncMessageReader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-asyncmessagewriter" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.4 AsyncMessageWriter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. プラグインの実装方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. プラグインの実装方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 プラグインに定められているメソッドを実装したクラスの作成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2 プラグインに定められているメソッドを実装したクラスの作成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.1 メッセージ受信のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#322" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.2 メッセージ送信のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#323-api" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.3 メッセージ受信(非同期API)のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#324-api" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.4 メッセージ送信(非同期API)のためのクラス
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 パッケージメタデータの作成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. プラグインの実装例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. プラグインの実装例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 ファイル構成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 プラグイン実装
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 プラグイン実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.1 モジュールレベル
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.2 メッセージ送信のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#423" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.3 メッセージ受信のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#424-api" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.4 メッセージ送信(非同期API)のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#425-api" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.5 メッセージ受信(非同期API)のためのクラス
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 パッケージング
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 パッケージング">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#431-setuppy-setupcfg" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.1 setup.py, setup.cfgの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#432" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.2 パッケージの作成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 ソースコード
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_broker_java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    message type
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            message type
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_value_type_python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_value_type_java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    compression
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            compression
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_compression_python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_compression_java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../message_format/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    メッセージフォーマット
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. はじめに
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. はじめに">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 対象者
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 前提知識
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-sinetstream" class="md-nav__link">
    <span class="md-ellipsis">
      2. SINETStream の内部構造について
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. SINETStream の内部構造について">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 モジュール構成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 処理シーケンス
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2 処理シーケンス">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-messagereader" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.1 MessageReader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-messagewriter" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2 MessageWriter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-asyncmessagereader" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.3 AsyncMessageReader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-asyncmessagewriter" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.4 AsyncMessageWriter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. プラグインの実装方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. プラグインの実装方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 プラグインに定められているメソッドを実装したクラスの作成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2 プラグインに定められているメソッドを実装したクラスの作成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.1 メッセージ受信のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#322" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.2 メッセージ送信のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#323-api" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.3 メッセージ受信(非同期API)のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#324-api" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.4 メッセージ送信(非同期API)のためのクラス
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 パッケージメタデータの作成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. プラグインの実装例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. プラグインの実装例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 ファイル構成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 プラグイン実装
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 プラグイン実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.1 モジュールレベル
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.2 メッセージ送信のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#423" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.3 メッセージ受信のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#424-api" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.4 メッセージ送信(非同期API)のためのクラス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#425-api" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.5 メッセージ受信(非同期API)のためのクラス
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 パッケージング
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 パッケージング">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#431-setuppy-setupcfg" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.1 setup.py, setup.cfgの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#432" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.2 パッケージの作成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 ソースコード
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<!--
Copyright (C) 2020 National Institute of Informatics

Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<p><a href="https://translate.google.com/translate?hl=en&amp;sl=ja&amp;tl=en&amp;u=https://nii-gakunin-cloud.github.io/sinetstream/docs/developer_guide/plugin_broker_python.html" title="google translate">English</a></p>
<h1 id="messaging-system-python">プラグイン開発ガイド(Messaging system / Python)</h1>
<p>新たなメッセージングシステムをSINETStream (Python)で扱えるようにするためのプラグインを開発する手順について説明します。</p>
<h2 id="1">1. はじめに</h2>
<p>SINETStream v1.2では以下に示すメッセージングシステムに対応しています。</p>
<ul>
<li><a href="https://kafka.apache.org/">Apache Kafka</a></li>
<li><a href="http://mqtt.org/">MQTT</a></li>
</ul>
<p>上記のメッセージングシステムに対応するための処理はプラグインとして実装されています。
さらに、新たなプラグインを実装することで、上記に示したメッセージングシステム以外のものをSINETStreamで扱えるようになります。</p>
<p>このドキュメントでは新たなメッセージングシステムをサポートするためのプラグインを開発する手順について説明します。</p>
<h3 id="11">1.1 対象者</h3>
<p>このドキュメントが対象としている読者を以下に示します。</p>
<ul>
<li>SINETStreamで新たなメッセージングシステムを利用できるようにしたい開発者</li>
<li>SINETStream内部の詳細について理解したい開発者</li>
</ul>
<h3 id="12">1.2 前提知識</h3>
<p>このドキュメントの説明は、以下の知識を有していることを前提としています。</p>
<ul>
<li>Python 3</li>
<li><a href="https://setuptools.readthedocs.io/en/latest/">setuptools</a> による配布パッケージの作成手順</li>
<li>SINETStream の Python APIの利用方法、設定ファイルの記述方法</li>
</ul>
<h2 id="2-sinetstream">2. SINETStream の内部構造について</h2>
<p>プラグインを開発する手順を説明する前に、開発の際に必要となるSINETStreamの内部構造について説明します。</p>
<h3 id="21">2.1 モジュール構成</h3>
<p>SINETStreamのモジュール構成を以下の図に示します。</p>
<p><img alt="モジュール構成" src="../images/SINETStream-module.png" /></p>
<p>青枠で示した部分がSINETStream本体です。この部分はメッセージングシステムによらない機能を提供しています。
緑枠で示した部分がSINETStreamのプラグインです。
メッセージングシステム固有の処理は緑枠で示したプラグインに閉じた実装となっています。</p>
<p>モジュールの各部についての簡単な説明を以下に記します。</p>
<ul>
<li>SINETStream本体<ul>
<li>API<ul>
<li>SINETStreamをライブラリとして利用する場合のインターフェース(API)を定める</li>
</ul>
</li>
<li>SPI<ul>
<li>SINETStream本体とプラグインとの間のインターフェースを定める</li>
</ul>
</li>
<li>シリアライザ<ul>
<li>APIが受け取ったオブジェクトをバイト列に変換する</li>
</ul>
</li>
<li>デシリアライザ<ul>
<li>メッセージングシステムから取得したバイト列をオブジェクトに変換する</li>
</ul>
</li>
<li>メタデータの埋め込み<ul>
<li>メッセージにメタデータを付加する</li>
<li>SINETStream v1.2 ではメッセージ送信時のタイムスタンプを付加している</li>
</ul>
</li>
<li>メタデータの取り出し<ul>
<li>メッセージに付加されているメタデータを取り出す</li>
</ul>
</li>
<li>暗号化<ul>
<li>メッセージの暗号化を行う</li>
</ul>
</li>
<li>復号化<ul>
<li>暗号化されたメッセージを復号する</li>
</ul>
</li>
<li>設定ファイル読み込み<ul>
<li>SINETStreamの設定ファイルを読み込む</li>
</ul>
</li>
<li>プラグイン管理<ul>
<li>SINETStreamのプラグインを管理する</li>
</ul>
</li>
</ul>
</li>
<li>プラグイン<ul>
<li>Kafkaプラグイン<ul>
<li>Kafkaブローカとの間でメッセージの送受信を行う機能</li>
<li>実際の処理は<a href="https://github.com/dpkp/kafka-python">kafka-python</a> の機能を呼び出すことで実現している</li>
</ul>
</li>
<li>MQTTプラグイン<ul>
<li>MQTTブローカとの間でメッセージの送受信を行う機能</li>
<li>実際の処理は<a href="https://www.eclipse.org/paho/clients/python/">eclipse paho</a> の機能を呼び出すことで実現している</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="22">2.2 処理シーケンス</h3>
<p>SINETStreamでメッセージの送受信を行うためのクラスMessageReader, MesageWriter, AsyncMessageReader, AsyncMessageWriter
の処理シーケンスについて説明します。</p>
<h4 id="221-messagereader">2.2.1 MessageReader</h4>
<p>以下に示すようなメッセージ受信処理を SINETStreamで行った場合のシーケンス図を示します。
ここではKafkaブローカーからメッセージを受信することを想定しています。</p>
<pre><code class="language-python">with MessageReader(service='kafka-service') as reader:
    for message in reader:
        print(f'value={message.value}')
</code></pre>
<p><img alt="MessageReader" src="../images/reader_sequence.png" /></p>
<p>図中のクラスについての簡単な説明を以下に記します。</p>
<ul>
<li>UserProgram<ul>
<li>SINETStreamを利用するプログラム</li>
</ul>
</li>
<li>MessageReader<ul>
<li>ブローカーからメッセージを受信するSINETStreamのクラス</li>
</ul>
</li>
<li>KafkaReader<ul>
<li>Kafkaブローカーからメッセージを受信するKafkaプラグインのクラス</li>
</ul>
</li>
<li>Iterator<ul>
<li>Kafkaブローカーから受信したメッセージをひとつづつ返すイテレータ</li>
</ul>
</li>
<li>Registry<ul>
<li>登録されているプラグインを管理するクラス</li>
</ul>
</li>
</ul>
<h4 id="222-messagewriter">2.2.2 MessageWriter</h4>
<p>以下に示すようなメッセージ送信処理を SINETStreamで行った場合のシーケンス図を示します。
ここではKafkaブローカーにメッセージを送信することを想定しています。</p>
<pre><code class="language-python">with MessageWriter(service='kafka-service') as writer:
    for message in messages:
        writer.publish(message)
</code></pre>
<p><img alt="MessageWriter" src="../images/writer_sequence.png" /></p>
<p>図中のクラスについての簡単な説明を以下に記します。</p>
<ul>
<li>UserProgram<ul>
<li>SINETStreamを利用するプログラム</li>
</ul>
</li>
<li>MessageWriter<ul>
<li>ブローカーにメッセージを送信するSINETStreamのクラス</li>
</ul>
</li>
<li>KafkaWriter<ul>
<li>Kafkaブローカーにメッセージ送信を行うKafkaプラグインのクラス</li>
</ul>
</li>
<li>Registry<ul>
<li>登録されているプラグインを管理するクラス</li>
</ul>
</li>
</ul>
<h4 id="223-asyncmessagereader">2.2.3 AsyncMessageReader</h4>
<p>以下に示すようなメッセージ受信処理を SINETStreamの非同期APIで行った場合のシーケンス図を示します。
ここではKafkaブローカーからメッセージを受信することを想定しています。</p>
<pre><code class="language-python">def show_message(message):
    print(f'value={message.value}')

reader = AsyncMessageReader(service='kafka-service')
reader.on_message = show_message
reader.open()

# 他の処理...

reader.close()
</code></pre>
<p><img alt="AsyncMessageReader" src="../images/async_reader_sequence.png" /></p>
<p>図中のクラスについての簡単な説明を以下に記します。</p>
<ul>
<li>UserProgram<ul>
<li>SINETStreamを利用するプログラム</li>
</ul>
</li>
<li>AsyncMessageReader<ul>
<li>ブローカーからメッセージを非同期APIで受信するSINETStreamのクラス</li>
</ul>
</li>
<li>KafkaAsyncReader<ul>
<li>Kafkaブローカーから非同期APIでメッセージを受信するKafkaプラグインのクラス</li>
</ul>
</li>
<li>Registry<ul>
<li>登録されているプラグインを管理するクラス</li>
</ul>
</li>
</ul>
<h4 id="224-asyncmessagewriter">2.2.4 AsyncMessageWriter</h4>
<p>以下に示すようなメッセージ送信処理をSINETStreamの非同期APIで行った場合のシーケンス図を示します。
ここではKafkaブローカーにメッセージを送信することを想定しています。</p>
<pre><code class="language-python">def on_publish(_):
    print(&quot;success&quot;)

with AsyncMessageWriter(service='kafka-service') as writer:
    for message in messages:
        writer.publish(message).then(on_publish)
</code></pre>
<p><img alt="AsyncMessageWriter" src="../images/async_writer_sequence.png" /></p>
<p>図中のクラスについての簡単な説明を以下に記します。</p>
<ul>
<li>UserProgram<ul>
<li>SINETStreamを利用するプログラム</li>
</ul>
</li>
<li>AsyncMessageWriter<ul>
<li>ブローカーにメッセージを非同期APIで送信するSINETStreamのクラス</li>
</ul>
</li>
<li>KafkaAsyncWriter<ul>
<li>Kafkaブローカーに非同期APIでメッセージ送信を行うKafkaプラグインのクラス</li>
</ul>
</li>
<li>Registry<ul>
<li>登録されているプラグインを管理するクラス</li>
</ul>
</li>
</ul>
<h2 id="3">3. プラグインの実装方法</h2>
<h3 id="31">3.1 概要</h3>
<p><a href="https://packaging.python.org/guides/creating-and-discovering-plugins/">Python Packaging User Guide - Creating and discovering plugins</a>
にあるように Python でプラグインを作成する場合、主に３つの方法があります。</p>
<ol>
<li>命名規則を用いる方法</li>
<li>名前空間パッケージを用いる方法</li>
<li>パッケージメタデータを用いる方法</li>
</ol>
<p>SINETStreamでは３番目のパッケージメタデータを用いてプラグインを実現しています。</p>
<p>SINETStreamのプラグインを作成するためには以下の作業が必要となります。</p>
<ul>
<li>プラグインに定められているメソッドを実装したクラスの作成</li>
<li>パッケージメタデータの作成</li>
</ul>
<p>それぞれの作業項目の詳細について以下に記します。</p>
<h3 id="32">3.2 プラグインに定められているメソッドを実装したクラスの作成</h3>
<p>プラグインで必要となるメソッドはメッセージを受信するためのクラスとメッセージを送信するためのクラスで異なります。
それぞれについて順に説明します。</p>
<h4 id="321">3.2.1 メッセージ受信のためのクラス</h4>
<p>メッセージ受信を行うプラグインで必要となるメソッドについて説明します。</p>
<p>メッセージ受信を行うプラグインのクラスでは、以下の３つのメソッドを実装する必要があります。</p>
<ul>
<li><code>open()</code><ul>
<li>ブローカーに接続を行うメソッド</li>
</ul>
</li>
<li><code>close()</code><ul>
<li>ブローカーとの接続を切断するメソッド</li>
</ul>
</li>
<li><code>__iter__()</code><ul>
<li>ブローカーから受信したメッセージのイテレータを返すメソッド</li>
<li>返り値は<a href="https://docs.python.org/ja/3.8/library/stdtypes.html#typeiter">イテレータオブジェクト</a> でなくてはならない</li>
<li>イテレータが返す、個々のメッセージは次の３つの値からなるタプルでなくてはならない<ul>
<li>メッセージのバイト列(メッセージングシステム依存のヘッダやメタデータを除いたペイロード部分の値。型は<code>bytes</code>)</li>
<li>受信したメッセージに対応するトピック名</li>
<li>メッセージングシステム依存のメッセージオブジェクト</li>
</ul>
</li>
<li>コンストラクタの<code>params['receive_timeout_ms']</code>で指定された時間(ミリ秒)の間にメッセージが受信できなかった場合は、イテレータは<code>StopIterator</code>の例外を送出しなくてはならない</li>
<li><code>params['receive_timeout_ms']</code>が指定されていなかった場合はメッセージを受信するまでブロックする</li>
</ul>
</li>
<li><code>metrics()</code><ul>
<li>プラグイン固有のメトリクス情報を返すメソッド</li>
<li>固有の情報がなければNoneを返す</li>
</ul>
</li>
<li><code>reset_metrics()</code><ul>
<li>サービスプロバイダ固有のメトリクス情報をリセットするメソッド</li>
</ul>
</li>
</ul>
<p>プラグインが上記のメソッドを実装することを確認するために、抽象基底クラス <code>sinetstream.spi.PluginMessageReader</code>
を利用することができます。<code>PluginMessageReader</code>では上記の３つのメソッドが抽象メソッドとして定義されています。</p>
<p>メッセージ受信を行うクラスのコンストラクタは引数から <code>params</code> を受け取ります。
<code>params</code>には、SINETStreamの設定ファイル、あるいは<code>MessageReader</code>のコンストラクタで指定されたパラメータが<code>dict</code>型の変数として渡されます。</p>
<h4 id="322">3.2.2 メッセージ送信のためのクラス</h4>
<p>メッセージ送信を行うプラグインで必要となるインターフェースについて説明します。</p>
<p>メッセージ送信を行うプラグインのクラスでは、以下の３つのメソッドを実装する必要があります。</p>
<ul>
<li><code>open()</code><ul>
<li>ブローカーに接続を行うメソッド</li>
</ul>
</li>
<li><code>close()</code><ul>
<li>ブローカーとの接続を切断するメソッド</li>
</ul>
</li>
<li><code>publish(message)</code><ul>
<li>ブローカーにメッセージを送信するメソッド</li>
<li><code>message</code>の型は <code>bytes</code> でなくてはならない</li>
</ul>
</li>
<li><code>metrics()</code><ul>
<li>プラグイン固有のメトリクス情報を返すメソッド</li>
<li>固有の情報がなければNoneを返す</li>
</ul>
</li>
</ul>
<p>プラグインが上記のメソッドを実装することを確認するために、抽象基底クラス <code>sinetstream.spi.PluginMessageWriter</code>
を利用することができます。<code>PluginMessageWriter</code>では上記の３つのメソッドが抽象メソッドとして定義されています。</p>
<p>メッセージ送信を行うクラスのコンストラクタは引数から <code>params</code> を受け取ります。
<code>params</code>には、SINETStreamの設定ファイル、あるいは<code>MessageWriter</code>のコンストラクタで指定されたパラメータが<code>dict</code>型の変数として渡されます。</p>
<h4 id="323-api">3.2.3 メッセージ受信(非同期API)のためのクラス</h4>
<p>非同期APIのメッセージ受信を行うプラグインで必要となるメソッドについて説明します。
以下の２つのメソッドと２つのプロパティを実装する必要があります。</p>
<ul>
<li><code>open()</code><ul>
<li>ブローカーに接続を行うメソッド</li>
</ul>
</li>
<li><code>close()</code><ul>
<li>ブローカーとの接続を切断するメソッド</li>
</ul>
</li>
<li><code>metrics()</code><ul>
<li>プラグイン固有のメトリクス情報を返すメソッド</li>
<li>固有の情報がなければNoneを返す</li>
</ul>
</li>
<li><code>.on_message</code><ul>
<li>メッセージを受信した時に呼び出すコールバック関数</li>
<li>引数で受信したメッセージを渡す</li>
</ul>
</li>
<li><code>.on_failure</code><ul>
<li>エラーが発生した時に呼び出すコールバック関数</li>
<li>引数でエラーの原因となった例外オブジェクトを渡す</li>
</ul>
</li>
</ul>
<p>プラグインが上記のメソッドを実装することを確認するために、抽象基底クラス <code>sinetstream.spi.PluginAsyncMessageReader</code>
を利用することができます。<code>PluginAsyncMessageReader</code>では上記のメソッド、プロパティが抽象メソッドとして定義されています。</p>
<p>メッセージ受信を行うクラスのコンストラクタは引数から <code>params</code> を受け取ります。
<code>params</code>には、SINETStreamの設定ファイル、あるいは<code>AsyncMessageReader</code>のコンストラクタで指定されたパラメータが<code>dict</code>型の変数として渡されます。</p>
<h4 id="324-api">3.2.4 メッセージ送信(非同期API)のためのクラス</h4>
<p>非同期APIのメッセージ送信を行うプラグインで必要となるインターフェースについて説明します。
以下の３つのメソッドを実装する必要があります。</p>
<ul>
<li><code>open()</code><ul>
<li>ブローカーに接続を行うメソッド</li>
</ul>
</li>
<li><code>close()</code><ul>
<li>ブローカーとの接続を切断するメソッド</li>
</ul>
</li>
<li><code>publish(message)</code><ul>
<li>ブローカーにメッセージを送信するメソッド</li>
<li><code>message</code>の型は <code>bytes</code> でなくてはならない</li>
<li>メソッドの呼び出しはブロックせずに直ぐに返ることを想定している</li>
<li>返り値は <a href="https://github.com/syrusakbary/promise"><code>Promise</code></a> オブジェクトでなくてはならない</li>
</ul>
</li>
<li><code>metrics()</code><ul>
<li>プラグイン固有のメトリクス情報を返すメソッド</li>
<li>固有の情報がなければNoneを返す</li>
</ul>
</li>
</ul>
<p>プラグインが上記のメソッドを実装することを確認するために、抽象基底クラス <code>sinetstream.spi.PluginAsyncMessageWriter</code>
を利用することができます。<code>PluginAsyncMessageWriter</code>では上記の３つのメソッドが抽象メソッドとして定義されています。</p>
<p>メッセージ送信を行うクラスのコンストラクタは引数から <code>params</code> を受け取ります。
<code>params</code>には、SINETStreamの設定ファイル、あるいは<code>AsyncMessageWriter</code>のコンストラクタで指定されたパラメータが<code>dict</code>型の変数として渡されます。</p>
<h3 id="33">3.3 パッケージメタデータの作成</h3>
<p><a href="http://setuptools.readthedocs.io/">setuptools</a> のエントリポイントにクラスを登録することで、
SINETStreamがプラグインを見つけることができるようになります。
これは登録されたエントリポイントをsetuptoolsが検出する機能を利用して実現しています。
setuptoolsはPythonの配布パッケージのビルドなどを行うためのツールです。</p>
<p>登録されているエントリポイントからSINETStreamで必要となるクラスを探し出すことができるようにするためには、
エントリポイントのグループと名前を適切に設定する必要があります。</p>
<p>SINETStreamではグループを<code>MessageReader</code>, <code>MessageWriter</code>, <code>AsyncMessageReader</code>, <code>AsyncMessageWriter</code>
のうちどのクラスに対応するのかを識別するために用いています。
以下に示すいずれかのグループを指定してください。</p>
<ul>
<li><code>sinetstream.reader</code><ul>
<li><code>MessageReader</code>から呼び出されるメッセージ受信を行うプラグインのグループ</li>
</ul>
</li>
<li><code>sinetstream.writer</code><ul>
<li><code>MessageWriter</code>から呼び出されるメッセージ送信を行うプラグインのグループ</li>
</ul>
</li>
<li><code>sinetstream.async_reader</code><ul>
<li><code>AsyncMessageReader</code>から呼び出されるメッセージ受信(非同期API)を行うプラグインのグループ</li>
</ul>
</li>
<li><code>sinetstream.async_writer</code><ul>
<li><code>AsyncMessageWriter</code>から呼び出されるメッセージ送信(非同期API)を行うプラグインのグループ</li>
</ul>
</li>
</ul>
<p>１つのプラグインで必ずしも上記全てのグループに対応する実装を提供する必要はありません。
必要なグループに関する記述のみを行ってください。</p>
<p>エントリポイントにはグループ内で識別するための名前がつけられます。
SINETSteramではエントリポイントに付けられた名前が、メッセージングシステムのタイプに対応づけられます。</p>
<p>例えばKafkaプラグインのメッセージ送信を行うクラス
<code>sinetstream_plugins.kafka:KafkaWriter</code> に対応するエントリポイントは
<code>sinetstream.writer</code>グループに所属する <code>kafka</code> という名前にします。</p>
<p>パッケージメタデータに上記の例のエントリポイントに対応する設定を行うには <code>setup.cfg</code> に以下の記述を行います。</p>
<pre><code>[options.entry_points]
sinetstream.writer =
    kafka = sinetstream_plugins.kafka:KafkaWriter
</code></pre>
<p>エントリポイントの詳細については
<a href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html#entry-points">setuptools documentation - Entry Points</a>
を参照してください。</p>
<h2 id="4">4. プラグインの実装例</h2>
<p>プラグインを実装する具体的な手順を示すために、簡単な実装例を示します。</p>
<p>ここで示す実装例では実際のブローカーにアクセスするのではなく、
プロセス内で<code>queue.Queue</code>オブジェクトを利用したデータの受け渡しを行う処理をSINETStreamのプラグインとして実現します。</p>
<h3 id="41">4.1 ファイル構成</h3>
<p>以下のファイルを作成します。</p>
<ul>
<li>src/ssplugin/queue.py<ul>
<li>SINETStreamプラグインの実装</li>
</ul>
</li>
<li>setup.py<ul>
<li>パッケージングを行う際のコマンドラインインタフェース</li>
</ul>
</li>
<li>setup.cfg<ul>
<li><code>setup.py</code>の設定ファイル</li>
</ul>
</li>
</ul>
<h3 id="42">4.2 プラグイン実装</h3>
<p>プラグインの実装を行うモジュールファイル<code>queue.py</code>について説明します。</p>
<h4 id="421">4.2.1 モジュールレベル</h4>
<p><code>queue.Queue</code>を格納するdict型変数をモジュールレベルで定義します。</p>
<pre><code class="language-python">queues = defaultdict(Queue)
</code></pre>
<p><code>queues</code>はトピック名をキー、<code>Queue</code>オブジェクトを値とする dict変数です。
<code>defaultdict</code>を利用することで、トピック名に対応する値が <code>queues</code>に無い場合は自動的に作成された <code>Queue</code>オブジェクトが取得できます。</p>
<h4 id="422">4.2.2 メッセージ送信のためのクラス</h4>
<p>メッセージ送信を行うプラグインのクラス<code>QueueWriter</code>を実装します。</p>
<p>まずクラス定義を行います。</p>
<pre><code class="language-python">class QueueWriter(PluginMessageWriter):
</code></pre>
<p>ここでは抽象基底クラス<code>PluginMessageWriter</code>を継承したクラスを定義します。
プラグインクラスの実装において<code>PluginMessageWriter</code>を継承することは必須ではありません。
しかし開発環境によっては抽象基底クラスを継承することにより、
プラグイン実装に必要となるメソッドに関する情報などの支援を受けられる場合があります。</p>
<p>次にコンストラクタを定義します。</p>
<pre><code class="language-python">    def __init__(self, params):
        self._queue = None
        self._topic = params.get('topic')
        if self._topic is None or not isinstance(self._topic, str):
            raise InvalidArgumentError()
</code></pre>
<p>引数の<code>params</code>にはSINETStreamの設定ファイル、
あるいは<code>MessageWriter</code>のコンストラクタで指定されたパラメータが<code>dict</code>型の変数として渡されます。
ここでは、パラメータ<code>topic</code>の値を送信対象のトピック名としてインスタンス変数に格納しています。</p>
<p>次にプラグインで実装する必要のあるメソッドを定義します。</p>
<pre><code class="language-python">    def open(self):
        self._queue = queues[self._topic]

    def close(self):
        self._queue = None

    def publish(self, value):
        self._queue.put(value)
</code></pre>
<p><code>open()</code>の際に <code>queues</code>からトピック名に対応する <code>Queue</code>のオブジェクトを取得します。
<code>publish(value)</code>では <code>open()</code>の際に格納した <code>Queue</code>オブジェクトにメッセージを<code>put()</code>します。
<code>publish()</code>で送られたメッセージは <code>Queue</code>オブジェクトを通して受信側に受け渡されます。</p>
<h4 id="423">4.2.3 メッセージ受信のためのクラス</h4>
<p>メッセージ受信を行うプラグインのクラス<code>QueueReader</code>を実装します。</p>
<p>まずクラス定義を行います。</p>
<pre><code class="language-python">class QueueReader(PluginMessageReader):
</code></pre>
<p>ここでは抽象基底クラス<code>PluginMessageReader</code>を継承したクラスを定義します。</p>
<p>次にコンストラクタを定義します。</p>
<pre><code class="language-python">    def __init__(self, params):
        self._queue = None
        self._topic = params.get('topic')
        if self._topic is None or not isinstance(self._topic, str):
            raise InvalidArgumentError()
        timeout_ms = params.get('receive_timeout_ms', inf)
        self._timeout = timeout_ms / 1000.0 if timeout_ms != inf else None
</code></pre>
<p>引数の<code>params</code>にはSINETStreamの設定ファイル、あるいは<code>MessageReader</code>のコンストラクタで指定されたパラメータが<code>dict</code>型の変数として渡されます。
ここでは、パラメータ<code>topic</code>の値を受信対象のトピック名としてインスタンス変数に格納しています。
また<code>receive_timeout_ms</code>をメッセージ受信のタイムアウト値(ms)としてインスタンス変数に格納します。</p>
<p>次にプラグインで実装する必要のあるメソッドを定義します。</p>
<pre><code class="language-python">    def open(self):
        self._queue = queues[self._topic]

    def close(self):
        self._queue = None

    def __iter__(self):
        while True:
            try:
                value = self._queue.get(timeout=self._timeout)
                raw = value
                yield value, self._topic, raw
            except Empty:
                raise StopIteration()

</code></pre>
<p><code>open()</code>の際に <code>queues</code>からトピック名に対応する <code>Queue</code>のオブジェクトを取得します。
<code>__iter__(value)</code>は <code>open()</code>の際に格納した <code>Queue</code>オブジェクトからメッセージ取得するイテレータを返します。
<code>MessageWriter</code>で送信されたメッセージは<code>Queue</code>オブジェクトを通して受け取ることができます。</p>
<h4 id="424-api">4.2.4 メッセージ送信(非同期API)のためのクラス</h4>
<p>非同期APIでメッセージ送信を行うプラグインのクラス<code>QueueAsyncWriter</code>を実装します。</p>
<p>まずクラス定義を行います。</p>
<pre><code class="language-python">class QueueAsyncWriter(PluginAsyncMessageWriter):
</code></pre>
<p>ここでは抽象基底クラス<code>PluginAsyncMessageWriter</code>を継承したクラスを定義します。
プラグインクラスの実装において<code>PluginAsyncMessageWriter</code>を継承することは必須ではありません。
しかし開発環境によっては抽象基底クラスを継承することにより、
プラグイン実装に必要となるメソッドに関する情報などの支援を受けられる場合があります。</p>
<p>次にコンストラクタを定義します。</p>
<pre><code class="language-python">    def __init__(self, params):
        self._queue = None
        self._topic = params.get('topic')
        if self._topic is None or not isinstance(self._topic, str):
            raise InvalidArgumentError()
        self._executor = None
</code></pre>
<p>引数の<code>params</code>にはSINETStreamの設定ファイル、あるいは<code>MessageWriter</code>のコンストラクタで指定されたパラメータが<code>dict</code>型の変数として渡されます。
ここでは、パラメータ<code>topic</code>の値を送信対象のトピック名としてインスタンス変数に格納しています。</p>
<p>次にプラグインで実装する必要のあるメソッドを定義します。</p>
<pre><code class="language-python">    def open(self):
        self._executor = ThreadPoolExecutor()
        self._queue = queues[self._topic]

    def close(self):
        self._queue = None
        self._executor.shutdown()

    def publish(self, value):
        future = self._executor.submit(lambda: self._queue.put(value))
        return Promise.cast(future)
</code></pre>
<p><code>open()</code>の際に <code>queues</code>からトピック名に対応する <code>Queue</code>のオブジェクトを取得します。
またメッセージ送信処理を行うスレッドプールを作成しておきます。
<code>publish(value)</code>では <code>open()</code>の際に作成したスレッドプールに送信処理を行うタスクを実行するように依頼します。
また送信処理を表す<code>Promise</code>オブジェクトを結果として返します。
<code>close()</code>では<code>open()</code>の際に作成したスレッドプールの資源解放を行います。</p>
<h4 id="425-api">4.2.5 メッセージ受信(非同期API)のためのクラス</h4>
<p>非同期APIでメッセージ受信を行うプラグインのクラス<code>QueueAsyncReader</code>を実装します。</p>
<p>まずクラス定義を行います。</p>
<pre><code class="language-python">class QueueAsyncReader(PluginAsyncMessageReader):
</code></pre>
<p>ここでは抽象基底クラス<code>PluginAsyncMessageReader</code>を継承したクラスを定義します。</p>
<p>次にコンストラクタを定義します。</p>
<pre><code class="language-python">    def __init__(self, params):
        self._queue = None
        self._topic = params.get('topic')
        if self._topic is None or not isinstance(self._topic, str):
            raise InvalidArgumentError()
        self._on_message = None
        self._on_failure = None
        self._reader_executor = None
        self._future = None
        self._closed = True
</code></pre>
<p>引数の<code>params</code>にはSINETStreamの設定ファイル、あるいは<code>MessageReader</code>のコンストラクタで指定されたパラメータが<code>dict</code>型の変数として渡されます。
ここでは、パラメータ<code>topic</code>の値を受信対象のトピック名としてインスタンス変数に格納しています。</p>
<p>次にプラグインで実装する必要のあるメソッドを定義します。</p>
<pre><code class="language-python">    def open(self):
        if self._closed:
            self._queue = queues[self._topic]
            self._reader_executor = ThreadPoolExecutor(max_workers=1)
            self._closed = False
            self._future = self._reader_executor.submit(self._reader_loop)

    def _reader_loop(self):
        while not self._closed:
            try:
                value = self._queue.get(timeout=0.1)
                raw = value
                if self._on_message is not None:
                    self._on_message(value, self._topic, raw),
            except Empty:
                pass

    def close(self):
        if not self._closed:
            self._queue = None
            self._future.cancel()
            self._reader_executor.shutdown()
            self._reader_executor = None
            self._future = None
            self._closed = True

    @property
    def on_message(self):
        return self._on_message

    @on_message.setter
    def on_message(self, on_message):
        self._on_message = on_message

    @property
    def on_failure(self):
        return self._on_failure

    @on_failure.setter
    def on_failure(self, on_failure):
        self._on_failure = on_failure
</code></pre>
<p><code>open()</code>ではメッセージ受信を行うスレッドプールを作成し、受信処理ループを実行しています。
受信処理ループでは、メッセージを受信するとコールバック関数<code>self._on_message()</code>を呼び出します。
<code>.on_message</code>, <code>.on_failure</code> は、それぞれメッセージ受信時、エラー発生時のコールバック関数に対応するプロパティとなっています。
<code>close()</code>では <code>open()</code>で起動した受信スレッドを停止しています。</p>
<h3 id="43">4.3 パッケージング</h3>
<h4 id="431-setuppy-setupcfg">4.3.1 <code>setup.py</code>, <code>setup.cfg</code>の作成</h4>
<p>パッケージングを行う際のコマンドラインインタフェースとなる <code>setup.py</code> とその設定ファイル <code>setup.cfg</code> を作成します。</p>
<p>まず <code>setup.py</code> を作成します。設定については全て<code>setup.cfg</code>で行うので <code>setup.py</code>は必要最小限なものとします。</p>
<pre><code class="language-python">from setuptools import setup
setup()
</code></pre>
<p>次に <code>setup.cfg</code> を作成します。</p>
<pre><code>[metadata]
name = sinetstream-queue
version = 1.2.0

[options]
package_dir=
    =src
packages = find_namespace:
zip_safe = False
namespace_packages =
  ssplugin
install_requires =
  sinetstream&gt;=1.2.0
  promise
python_requires = &gt;= 3.6

[options.packages.find]
where = src

[options.entry_points]
sinetstream.reader =
    queue = ssplugin.queue:QueueReader
sinetstream.writer =
    queue = ssplugin.queue:QueueWriter
sinetstream.async_reader =
    queue = ssplugin.queue:QueueAsyncReader
sinetstream.async_writer =
    queue = ssplugin.queue:QueueAsyncWriter
</code></pre>
<p>プラグインに直接関わる設定は <code>options.entry_points</code>セクションです。
<code>sinetstream.reader</code>, <code>sinetstream.writer</code>がメッセージ受信、メッセージ送信のプラグインに対応するグループになります。
また <code>sinetstream.async_reader</code>, <code>sinetstream.async_writer</code>が非同期APIのメッセージ受信、メッセージ送信のプラグインに対応するグループになります。
各グループに対して (メッセージングシステムのタイプ名)=(パッケージ名:クラス名) を指定しています。</p>
<h4 id="432">4.3.2 パッケージの作成</h4>
<pre><code class="language-bash">$ python setup.py bdist_wheel
running bdist_wheel
running build
running build_py
(中略)
$ ls dist/
dist/sinetstream_queue-1.2.0-py3-none-any.whl
</code></pre>
<h3 id="44">4.4 ソースコード</h3>
<p>ここまで記した実装例のファイルへのリンクを以下に示します。
* <a href="https://github.com/nii-gakunin-cloud/sinetstream/blob/main/docs/developer_guide/sample/messaging-system/python/src/ssplugin/queue.py">src/ssplugin/queue.py</a>
* <a href="https://github.com/nii-gakunin-cloud/sinetstream/blob/main/docs/developer_guide/sample/messaging-system/python/setup.py">setup.py</a>
* <a href="https://github.com/nii-gakunin-cloud/sinetstream/blob/main/docs/developer_guide/sample/messaging-system/python/setup.cfg">setup.cfg</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  ページトップへ戻る
</button>
        
      </main>
      
        <div class="site-footer-copyright">Copyright(C) National Institute of Informatics</div>
<div class="site-footer-logo">
  <a href="https://www.nii.ac.jp/">
    
    <img src="../../images/NIIlogo_JP_ls.png" alt="NII 国立情報学研究所">
    
  </a>
</div>
<footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.tabs", "navigation.tabs.sticky", "navigation.top"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>